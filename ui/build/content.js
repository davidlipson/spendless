!function(){"use strict";var e={5144:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=n(824);let i=!1,r=null;const s=e=>o(void 0,void 0,void 0,(function*(){if(e){const{user:t,url:n,query:i,description:d,page:v,recent:y,totalRegex:g,processButtonEndWords:x,processButtons:E}=e;console.log(e),window.setTimeout((()=>o(void 0,void 0,void 0,(function*(){if(null!=v){const{total:H,tid:P,amount:q}=yield l(t,n,i,d,v,y,g,!0);if(p(),r&&r.disconnect(),r=((e,t)=>{const{user:n,url:o,query:a,description:i,page:r,recent:c,totalRegex:d}=e;return new MutationObserver((u=>{l(n,o,a,i,r,c,d).then((n=>{n.amount!=t&&s(e)}))}))})(e,q),r.observe(document,{characterDataOldValue:!0,subtree:!0,childList:!0,characterData:!0,attributes:!0}),q>0){m(E,x,P,t.id);var C=document.createElement("div");C.className="spendless-ext-root",document.getElementsByTagName("html")[0].appendChild(C);var T=document.createElement("div");T.className="spendless-ext-app spendless-ext-popup",C.appendChild(T);var M=document.createElement("span");M.className="spendless-ext-popup-header",M.innerHTML=String(a.dev?q:"Spend less, save more!"),T.appendChild(M);var N=document.createElement("div");N.className="spendless-ext-summary-lines",T.appendChild(N);var S=document.createElement("div");S.className="spendless-ext-summary-div";var b=document.createElement("span");b.className="spendless-ext-summary-value",b.innerHTML=`${f(Math.ceil(H),Math.ceil(t.budget))}%`,S.appendChild(b);var w=document.createElement("span");w.className="spendless-ext-summary-line spendless-ext-small-cap-font",w.innerHTML="AMOUNT SPENT",S.appendChild(w),N.appendChild(S);var j=document.createElement("div");j.className="spendless-ext-summary-div";var L=document.createElement("span");L.className="spendless-ext-summary-value",L.innerHTML=h(Math.ceil(t.budget)-Math.ceil(H)).replace(".00",""),j.appendChild(L);var A=document.createElement("span");A.className="spendless-ext-summary-line spendless-ext-small-cap-font",A.innerHTML="LEFT IN BUDGET",j.appendChild(A),N.appendChild(j);var O=document.createElement("div");if(O.className="spendless-ext-popup-hide",O.innerHTML="Hide this message",O.onclick=function(e){p()},T.appendChild(O),"processed"!==v){var $=document.createElement("div");$.className="spendless-ext-popup-ignore",$.innerHTML="Ignore this transaction",$.onclick=function(e){return o(this,void 0,void 0,(function*(){yield c(t.id,P),p(),u("<span style='font-weight: 800'>Got it!</span> This transaction won't be included in your budget.")}))},T.appendChild($)}}}}))),1500)}})),l=(e,t,n,r,s,l,c,u=!1)=>o(void 0,void 0,void 0,(function*(){var o;const p=e.id;let m=0,h="",f=null;if("processed"!=s)try{let e="";r&&(e=null===(o=document.querySelector(r))||void 0===o?void 0:o.textContent.trim()),h=e&&""!=e?e:t.match(/^https?:\/\/[^#?\/]+/)||"";const i=v(c),s=0===i[0]?g([...document.querySelectorAll(n)]):i;m=Math.max(s[0],i[0]),f=m===i[0]?i[1]:s[1],a.dev&&f&&(f.style.background="red")}catch(e){console.log(e)}if(console.log(`Spendlo Page --- Amount: ${m}`),u){if(i)return console.log("not updating"),{amount:0};const e=yield d(p,m,h,null==l?void 0:l.id);return{total:null==e?void 0:e.total,tid:null==e?void 0:e.tid,amount:m,div:f}}return{amount:m}}));chrome.runtime.onMessage.addListener(s);const c=(e,t)=>o(void 0,void 0,void 0,(function*(){try{return yield fetch(`${a.host}/ignore`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uid:e,id:t})})}catch(e){return 0}})),d=(e,t,n,i)=>o(void 0,void 0,void 0,(function*(){try{console.log("updating transaction");const o=yield fetch(`${a.host}/add`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uid:e,amount:t,description:n,tid:i})}),{total:r,tid:s}=yield o.json();return{total:r,tid:s}}catch(e){return null}})),u=(e,t=3e3)=>{var n=document.createElement("div");n.className="spendless-ext-popup-message",n.innerHTML=e,document.getElementsByTagName("html")[0].appendChild(n),window.setTimeout((function(){n.style.display="none"}),t)},p=()=>{document.querySelectorAll(".spendless-ext-root").forEach((e=>{try{e.remove()}catch(e){console.log(e)}}))},m=function(e,t,n,r){const s=e.map((e=>e.trim())).join("|"),l=t.map((e=>e.trim())).join("|"),c=new RegExp(`^(${s})(${l}){0,1}$`,"i");let d=[...document.querySelectorAll("a, span, input, button")];return d=d.filter((e=>e.textContent&&null!==e.textContent.trim().replace(/\n/g,"").match(c))),d.forEach((e=>{a.dev&&(e.style.background="green"),e.onmouseover=function(e){((e,t)=>{o(void 0,void 0,void 0,(function*(){if(!i)try{console.log("processing transaction");const n=yield fetch(`${a.host}/process`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uid:e,tid:t})}),{total:o}=yield n.json();return i=!0,{total:o}}catch(e){return 0}}))})(r,n)}})),d},v=e=>{let t=[...document.querySelectorAll("div, tr, li, dl")];t=t.filter((t=>null!==((e,t)=>{const n=new RegExp(e,"i");return t.textContent.trim().replaceAll("\n","").match(n)})(e,t)));const n=Math.min(...t.map((e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.length)||0})));return g(t.filter((e=>{var t;return(null===(t=e.textContent)||void 0===t?void 0:t.length)===n})))},h=e=>{try{return e.toLocaleString("en-US",{style:"currency",currency:"USD"})}catch(e){return""}},f=(e,t)=>Math.floor(100*Math.max(0,e/t)),y=e=>{var t=e.textContent.replaceAll(" ","").match(/\$?[1-9][0-9]*,?[0-9]*(\.[0-9][0-9])?/g);return t?t.map((e=>parseFloat(e.replace("$","").replace(",","")))):[]},g=e=>{if(0===e.length)return[0];let t=[0];e.forEach((e=>{t=t.concat(y(e).filter((e=>e>0&&e<1e4)))}));const n=Math.max(...t),o=e.find((e=>y(e).includes(n)));return[n,o]}},824:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.dev=t.host=void 0,t.host="http://localhost:5000",t.dev=!0}},t={};!function n(o){var a=t[o];if(void 0!==a)return a.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(5144)}();